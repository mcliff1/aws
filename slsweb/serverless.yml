service: slsweb
#  designed to be a 'simple' serverless site with managed content
#  must run in us-east-1 for CDN and custom domain name/certs

frameworkVersion: ">=1.9.0 <2.0.0"

custom:
  stage: ${opt:stage, self:provider.stage}
  rootDomain: mattcliff.net
  devDomains:
    - qa.mattcliff.net
  prodDomains:
    - www.mattcliff.net
    - mattcliff.net

provider:
  name: aws
  region: us-east-1
  runtime: nodejs6.10


resources:

  #Mappings: ${file(resources/mappings.yml)}

  #Outputs: ${file(resources/outputs.yml)}
  
  
  
  Resources:
    WebSite:
      Type: "AWS::S3::Bucket"
      Properties:
        WebsiteConfiguration:
          ErrorDocument: index.html
          IndexDocument: index.html


    UserPool:
      Type: "AWS::Cognito::UserPool"
      Properties:
        UsernameAttributes:
          - email
        MfaConfiguration: OFF
        UserPoolName: slswebpool-${self:custom.stage}
        Schema:
          - Name: email
            AttributeDataType: String
            Mutable: false
            Required: true


    UserPoolClient:
      Type: "AWS::Cognito::UserPoolClient"
      Properties:
        ClientName: slswebpool-${self:custom.stage}-app
        ExplicitAuthFlows:
          - ADMIN_NO_SRP_AUTH
        GenerateSecret: False
        UserPoolId: {Ref: UserPool}


    #DnsRecords: ${file(resources/${self:custom.stage}-dns.yml)}
    #SSLCert: ${file(resources/${self:custom.stage}-ssl.yml)}


